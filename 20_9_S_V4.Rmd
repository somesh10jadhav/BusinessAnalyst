---
title: "project_1"
author: "Somesh J, Viren Y, Priti G, Anand K"
date: '2022-09-13'
output: html_document
---

# Project 1
## IBM Dataset

### Understanding the data

Importing dataframe
```{r}
df <- read.csv("/Users/Jadhav/Documents/The Data Cartel/Project_1/hr.csv")
```

```{r}
df1 <- read.csv("/Users/Jadhav/Documents/The Data Cartel/Project_1/hr.csv")
```

Viewing dataframe
```{r}
View(df)
```


## Project planning
1. HR Theory Consultant : Viren
2. Data visualization : Priti
3. Analytical Lead : Anand
4. Team leader : Somesh

Loading the libraries
```{r}
library(dplyr)
library(ggplot2)
library(janitor)
```

Data about data
```{r}
glimpse(df)
```

Data Cleaning & Preparation :
1. Convert Yes/No in 1/0 (Factor)
2. Convert all categorical varibales from chr to factor
3. Check Na values and deal with it
4. Remove duplicate data
5. Replace coded data with respective meaning & Convert categorical data into factor for viz and analysis
6. Dimensionality reduction (drop cols) : Over18, Standard Hours
7. Sort dataframe by Age


Below code shows everyone is over 18 hence it can be dropped
```{r}
unique(df$Over18)
```

Dropping Over18 column
```{r}
df <- df%>%
  select(-Over18)
```

Everyone's standard hours are 80
```{r}
unique(df$StandardHours)
```

Dropping StandardHours column
```{r}
df <- df%>%
  select(-StandardHours)
```

## Converting Yes/No in 1/0 factor 

Attrition
```{r}
df$Attrition <- as.factor(ifelse(df$Attrition=="Yes",1,0))

```

OverTime
```{r}
df$OverTime<- as.factor(ifelse(df$OverTime=="Yes",1,0))
```

## Replacing all coded values into their meanings

Education
```{r}
for (i in 1:1470) {
  
  if (df$Education[i]==1) {
    df$Education[i]<-"Below College"
  }
  else if (df$Education[i]==2) {
    df$Education[i] <- "College"
  }
  else if (df$Education[i]==3) {
    df$Education[i] <- "Bachelor"
  }
  else if (df$Education[i]==4) {
    df$Education[i] <- "Master"
  }
  else if (df$Education[i]==5) {
    df$Education[i] <- "Doctor"
  }
}
```

```{r}
df$Education <- as.factor(df$Education)
```


Environment Satisfaction
```{r}
for (i in 1:1470) {
  
  if (df$EnvironmentSatisfaction[i]==1) {
    df$EnvironmentSatisfaction[i]<-"Low"
  }
  else if (df$EnvironmentSatisfaction[i]==2) {
    df$EnvironmentSatisfaction[i] <- "Medium"
  }
  else if (df$EnvironmentSatisfaction[i]==3) {
    df$EnvironmentSatisfaction[i] <- "High"
  }
  else if (df$EnvironmentSatisfaction[i]==4) {
    df$EnvironmentSatisfaction[i] <- "Very High"
  }
 
}

```

```{r}
df$EnvironmentSatisfaction <- as.factor(df$EnvironmentSatisfaction)
```


Job Involvement
```{r}
for (i in 1:1470) {
  
  if (df$JobInvolvement[i]==1) {
    df$JobInvolvement[i]<-"Low"
  }
  else if (df$JobInvolvement[i]==2) {
    df$JobInvolvement[i] <- "Medium"
  }
  else if (df$JobInvolvement[i]==3) {
    df$JobInvolvement[i] <- "High"
  }
  else if (df$JobInvolvement[i]==4) {
    df$JobInvolvement[i] <- "Very High"
  }
 
}
```

```{r}
df$JobInvolvement <- as.factor(df$JobInvolvement)
```

Job Satisfaction
```{r}
for (i in 1:1470) {
  
  if (df$JobSatisfaction[i]==1) {
    df$JobSatisfaction[i]<-"Low"
  }
  else if (df$JobSatisfaction[i]==2) {
    df$JobSatisfaction[i] <- "Medium"
  }
  else if (df$JobSatisfaction[i]==3) {
    df$JobSatisfaction[i] <- "High"
  }
  else if (df$JobSatisfaction[i]==4) {
    df$JobSatisfaction[i] <- "Very High"
  }
 
}
```

```{r}
df$JobSatisfaction <- as.factor(df$JobSatisfaction)
```

Performance Rating
```{r}
for (i in 1:1470) {
  
  if (df$PerformanceRating[i]==1) {
    df$PerformanceRating[i]<-"Low"
  }
  else if (df$PerformanceRating[i]==2) {
    df$PerformanceRating[i] <- "Good"
  }
  else if (df$PerformanceRating[i]==3) {
    df$PerformanceRating[i] <- "Excellent"
  }
  else if (df$PerformanceRating[i]==4) {
    df$PerformanceRating[i] <- "Outstanding"
  }
 
}
```

```{r}
df$PerformanceRating <- as.factor(df$PerformanceRating)
```

Relationship Satisfaction
```{r}
for (i in 1:1470) {
  
  if (df$RelationshipSatisfaction[i]==1) {
    df$RelationshipSatisfaction[i]<-"Low"
  }
  else if (df$RelationshipSatisfaction[i]==2) {
    df$RelationshipSatisfaction[i] <- "Medium"
  }
  else if (df$RelationshipSatisfaction[i]==3) {
    df$RelationshipSatisfaction[i] <- "High"
  }
  else if (df$RelationshipSatisfaction[i]==4) {
    df$RelationshipSatisfaction[i] <- "Very High"
  }
 
}
```

```{r}
df$RelationshipSatisfaction <- as.factor(df$RelationshipSatisfaction)
```

Worklife Balance
```{r}
for (i in 1:1470) {
  
  if (df$WorkLifeBalance[i]==1) {
    df$WorkLifeBalance[i]<-"Bad"
  }
  else if (df$WorkLifeBalance[i]==2) {
    df$WorkLifeBalance[i] <- "Good"
  }
  else if (df$WorkLifeBalance[i]==3) {
    df$WorkLifeBalance[i] <- "Better"
  }
  else if (df$WorkLifeBalance[i]==4) {
    df$WorkLifeBalance[i] <- "Best"
  }
 
}
```

```{r}
df$WorkLifeBalance <- as.factor(df$WorkLifeBalance)
```

Converting other categorical variables into factor
```{r}
df$StockOptionLevel <- as.factor(df$StockOptionLevel)
df$BusinessTravel <- as.factor(df$BusinessTravel)
df$Department <- as.factor(df$Department)
df$EducationField <- as.factor(df$EducationField)
df$Gender <- as.factor(df$Gender)
df$JobLevel <- as.factor(df$JobLevel)
df$JobRole <- as.factor(df$JobRole)
df$MaritalStatus <- as.factor(df$MaritalStatus)
```

```{r}
glimpse(df)
```


## Checking Na Values
```{r}
sum(as.integer(as.logical(is.na(df))))
```
There are no Na Values in this dataset

## Removing duplicates
```{r}
df <- distinct(df)
```

## Sorting dataframe by age
```{r}
df <- df %>%
  arrange(Age)  

```

The dataframe is now fairly cleaned

## Questions

Give average age by gender and job role.

Average Age by gender
```{r}
df%>%
  group_by(Gender)%>%
  summarise(avg_age = round(mean(Age),digits=2))
```
Average age of female employees is 37.33
Average age of female employees is 36.65


How does travelling affect job involvement and job satisfaction?
```{r}
df %>%
  group_by(JobSatisfaction) %>%
  summarise(avg_distance_from_home = round(mean(DistanceFromHome),digits = 2))

```
Distance doesn't seem to have any significant impact on JobSatisfaction

Boxplots
```{r}
ggplot( data = df ) +
  geom_boxplot(mapping = aes (x=JobSatisfaction, y = DistanceFromHome))
```
A big chunk of employees live right near the office
```{r}
hist(df$DistanceFromHome)
```
  
```{r}
cor(df1$JobSatisfaction,df1$DistanceFromHome)
```
No significannt correlation found

What is monthly income of each gender by their job role?
```{r}
df %>% 
  group_by(Gender,JobRole) %>%
  summarise(avg_m_income = mean(MonthlyIncome)) %>%
  arrange(desc(avg_m_income))
```

Which job role is more likely to work over time?

```{r}
 x <- df %>%
  group_by(JobRole) %>%
  summarise(total_workers = n()) 
  
```


```{r}

x <- mutate(x, ot = 0)
x
```
Getting number of people who work overtime 
```{r}
a <- df %>%
  filter(OverTime=="1" & JobRole=="Healthcare Representative") %>%
  nrow()

b <- df %>%
  filter(OverTime=="1" & JobRole=="Human Resources") %>%
  nrow()

c <- df %>%
  filter(OverTime=="1" & JobRole=="Laboratory Technician") %>%
  nrow() 

d <- df %>%
  filter(OverTime=="1" & JobRole=="Manager") %>%
  nrow() 

e <- df %>%
  filter(OverTime=="1" & JobRole=="Manufacturing Director") %>%
  nrow() 

f <- df %>%
  filter(OverTime=="1" & JobRole=="Research Director") %>%
  nrow() 

g <- df %>%
  filter(OverTime=="1" & JobRole=="Research Scientist") %>%
  nrow() 

h <- df %>%
  filter(OverTime=="1" & JobRole=="Sales Executive") %>%
  nrow() 

k <- df %>%
  filter(OverTime=="1" & JobRole=="Sales Representative") %>%
  nrow() 
```
Combining them in vector z
```{r}
z <- c(a,b,c,d,e,f,g,h,k)
```
Adding number of people who work overtime in opposite each Job Role
```{r}
for (i in 1:9) {
  x$ot[i] = z[i]
}
```
Getting probability of every job role working OverTime
```{r}
x <- x %>%
  mutate(probability_of_working_ot = round((x$ot/x$total_workers)*100,digits=2)) %>%
  arrange(desc(probability_of_working_ot))
x
```
Research scientists are more likely to work over time

Marital Status V Performance Rating
```{r}
maritalVperform <- df %>%
  group_by(MaritalStatus , PerformanceRating) %>%
  summarise(count = n()) %>%
  arrange(desc(PerformanceRating)) 

maritalVperform
```
```{r}
mar <- c("Divorced","Married","Single")
mar_count <- c()
```

Gettinng number of employees under each category
```{r}
  for (j in 1:3) {
  mar_count[j] <- df %>%
  filter(df$MaritalStatus==mar[j])%>%
  nrow()
  }
  
```

```{r}
mar_count <- c(mar_count,mar_count)
```

Adding empty column to maritalVperform
```{r}
maritalVperform <- mutate(maritalVperform, total_under_martial=0)
maritalVperform
```

Adding count of total employees opposite respective category
```{r}
  for (i in 1:6) {
  maritalVperform$total_under_martial[i] = mar_count[i]
  }

```

Renaming a column
```{r}
maritalVperform <- maritalVperform %>%
  rename(both = count) 
  
maritalVperform

```

```{r}
maritalVperform <- maritalVperform %>%
  select(MaritalStatus, total_under_martial, PerformanceRating, both) %>%
  mutate(percentage = round((both/total_under_martial)*100,digits=2))

maritalVperform
```
Comparing under outstanding category,
Married people are performing slightly better
Comparing under excellent category,
Divorced people are performing slightly better


Compare monthly income of each department with their work life
balance.


```{r}
 d_wb <- df %>%
  group_by(Department,WorkLifeBalance) %>%
  summarise(avg_pay = mean(MonthlyIncome)) %>%
  mutate(category = paste(Department," : ",WorkLifeBalance)) %>%
  arrange(desc(avg_pay))

d_wb
```



```{r}
ggplot(data=d_wb) +
  geom_bar( stat = "sum",mapping = aes(x=avg_pay,y=category, color = Department, alpha = Workl))
```
Sales people with bad worklife balance have the highest monthly pay

Find attributes influencing job satisfaction.

```{r}
glimpse(df)
```
Job Satisfaction V YearsSinceLastPromotion 
```{r}
df %>%
  group_by(JobSatisfaction) %>%
  summarise(avg_years = mean(YearsSinceLastPromotion)) %>%
  arrange(desc(avg_years))
```
No significant correlation found

Job Satisfaction V YearsWithCurrManager
```{r}
df %>%
  group_by(JobSatisfaction) %>%
  summarise(avg_years = mean(YearsWithCurrManager)) %>%
  arrange(desc(avg_years))
```
No significant correlation found

Job Satisfaction V YearsInCurrentRole
```{r}
df %>%
  group_by(JobSatisfaction) %>%
  summarise(avg_years = mean(YearsInCurrentRole)) %>%
  arrange(desc(avg_years))
```
No significant correlation found

Job Satisfaction V YearsAtCompany  
```{r}
df %>%
  group_by(JobSatisfaction) %>%
  summarise(avg_years = mean(YearsAtCompany )) %>%
  arrange(desc(avg_years))
```
People who have worked more years at the company are observed to have Medium to High Job Satisfactionn
People with lesser years at the company tend to have Either too low or too high Job Satisfaction


Job Satisfaction V MonthlyIncome
```{r}
df %>%
  group_by(JobSatisfaction) %>%
  summarise(avg_income = mean(MonthlyIncome )) %>%
  arrange(desc(avg_income))
```
It is observed that, surprisingly, people with highest monthly income tend to have a lower Job Satisfaction.
Whereas, people who earn comparatively less, tend to have higher Job Satisfaction

Job Satisfaction V Department
```{r}
df %>%
  group_by(JobSatisfaction, Department) %>%
  summarise(total = n())
```
#Complete Further

Find the average salary and performance rating for the freshers in IBM
```{r}
df1 %>%
  filter(YearsAtCompany<=1) %>%
  summarise(avg_salary= round(mean(MonthlyIncome),digits=2), 
            avg_rating = round(mean(PerformanceRating),digits=2)
```
Average salary for a fresher ir 4565$ a month and average rating is 3.17


What is the average hourly rate for different genders? Is there any gap.

```{r}
summary(df$HourlyRate)
```

```{r}
df%>%
  group_by(Gender)%>%
  summarise(avg_hour_rate = mean(HourlyRate))
```
No wage gap between two genders

Top 10 Employees below 40 age who are with IBM for more than 5 years.
```{r}
df%>%
  filter(Age<40, YearsAtCompany>5, PerformanceRating== "Outstanding" ) 

```

Suggest which employees should get promoted next year?

```{r}
df%>%
  filter(PerformanceRating == "Outstanding" &
           OverTime=="1" &
           Age <35
           )
```

